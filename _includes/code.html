<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<div id="code-show-div">
    <button id="code-edit" type="button" onclick="editFunction()">编辑</button>
    <pre id="example-code"><code>#include &lt;stdio.h>
int main() {
    printf("Hello, World!\n");
    return 0;
}</code></pre>
</div>
<div id="code-edit-div" style="display: none;">
    <button id="code-exit" type="button" onclick="exitFunction()">退出</button>
    <button id="code-run" type="button" onclick="runFunction()">运行</button>
    <pre contenteditable="plaintext-only" oninput="inputFunction()"><code id="real-code">#include &lt;stdio.h>
int main() {
    printf("Hello, World!\n");
    return 0;
}</code></pre>
</div>

<script>
    function editFunction() {
        document.getElementById("code-show-div").style.display = "none";
        document.getElementById("code-edit-div").style.display = "block";
    }
    function exitFunction() {
        document.getElementById("code-edit-div").style.display = "none";
        document.getElementById("code-show-div").style.display = "block";
    }
    function runFunction() {
        alert(1);
        var http = new XMLHttpRequest();
        alert(2);
        http.open("POST", "http://coliru.stacked-crooked.com/compile", false);
        alert(3);
        http.send(JSON.stringify({ "cmd": "g++ main.cpp && ./a.out", "src": document.getElementById("real-code").innerText }));
        alert(4);
        alert(http.response);
    }
    function inputFunction() {
        var selection = getSelection();
        var range = selection.getRangeAt(0);
        range.setEndAfter(document.getElementById("real-code"));
        range.setStart(range.endContainer, range.endOffset);
        hljs.highlightElement(document.getElementById("real-code"));
        selection.removeAllRanges();
        selection.addRange(range);
    }
    hljs.highlightAll();
</script>